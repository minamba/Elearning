@model  ELearning.Models.SubchapterWithCommentsAndReply


@{ 
    string video = Model.CurrentSubchapter.url_video;
    var subchapter = Model.CurrentSubchapter;
    var chapter_id = Model.CurrentSubchapter.chapter_id;
    var subchapter_id = Model.CurrentSubchapter.id;
}

<div class="embed-responsive embed-responsive-16by9 sticky  "  @Model.DisplayVideo(@subchapter) >
    <divpv class="video-frame "  oncontextmenu="return false">

        <video class="shadow-lg  " id="currentVideo" controls controlsList="nodownload">
            @*<source class="" src="@Url.Content("~/content/Video/" + @Model.CurrentSubchapter.url_video)" type="video/mp4" />*@
            <source src="@Url.Content("http://vps64363.lws-hosting.com/Video/" + @Model.CurrentSubchapter.url_video +"#t="+@Model.video.time_start)" type="video/mp4" />
        </video>
    </divpv>
</div>



<!--SCIRPT TO GET VIDEO TIMESPAMP-->
<script>
    var vid = document.getElementById("currentVideo");
    var url_vid = "@video";

    vid.onpause = function () {
       
        console.log("le current time est : " + url_vid);
        $.ajax({
            type: "POST",
            url: "/Subchapter_/PushCurrentVideoTime",
            contentType: "application/json; charset=utf-8",
            data: '{"currentTime":"' + Math.round(vid.currentTime) + '","url_video":"' + url_vid + '","duration":"' + Math.round(vid.duration) + '"}',
            dataType: "json",
            success: function (result, status, xhr) {
                console.log(result);
            }
        });
    }
</script>
<!---->

<!--VIDEO ENDED-->
<script type='text/javascript'>
    document.getElementById('currentVideo').addEventListener('ended', myHandler, false);
    var vidEnd = document.getElementById("currentVideo");
    var url_vid = "@video";
    var subchap_id = "@subchapter_id";
    var chap_id = "@chapter_id";
    function myHandler(e) {
        // What you want to do after the event
        console.log("fin de la video");
        $.ajax({
            type: "POST",
            url: "/Subchapter_/PushCurrentVideoFinished",
            contentType: "application/json; charset=utf-8",
            data: '{"currentTime":"' + Math.round(vidEnd.currentTime) + '","url_video":"' + url_vid + '","duration":"' + Math.round(vidEnd.duration) + '","subchapter_id":"' + subchap_id + '","chapter_id":"' + chap_id + '"}',
            dataType: "json",
            success: function (result, status, xhr) {
                console.log(result);
            }
        });
    }
</script>


@model  ELearning.Models.SubchapterWithCommentsAndReply

@{
    //int totalTimeVideo = 0;
    string[] time = null;
    Layout = "~/Views/Shared/_LayoutHome.cshtml";
   
    int ind2 = 1;
    List<string> index = new List<string>();

    for (int i = 0; i <= 1000; i++)
    {
        index.Add("indexe" + i);
    }

    string date;
    var displayppt = "";
}

<head>
    <script type="text/javascript">
        function user_onclear() {
            $("#msg2").val("");
            // Change "EditorID" to the EditorID that you like to remove the text.
            //$("#EditorID").val("");
        }


        function AjaxPost(formData) {

            var ajaxConfig = {
                type: "post",
                url: "/Comment_/SaveComment",
                data: new FormData(formData),
                success: function (result) {
                    alert(result);
                    window.location.href = ("Index?sub_chapter_id="+@Model.CurrentSubchapter.id+"&class_id="+ @Model.CurrentSubchapter.Chapter_.class_id)
                }
            }
            if ($(formData).attr('enctype') == "multipart/form-data") {
                ajaxConfig['contentType'] = false;
                ajaxConfig['processData'] = false;
            }
            $.ajax(ajaxConfig);
            return false;
        }

        //fonction ajax qui me permet de recharger la partial vu qui contient la vidéo
        $(function () {
            $(".loadVideo").click(function (e) { //obligé d'utiliser une classe pour que tous les elements soit pris en compte. si j'utilise un id="blabla" dans une boucle, il va prendre que le premier element
                e.preventDefault();
                var url = $(this).data("url");
                console.log("url information" + url);
                $("#showVideo").load(url);
            });
        });

        //fonction ajax qui me permet de recharger la partial vu qui contient les commentaires
        $(function () {
            $(".loadComment").click(function (e) { //obligé d'utiliser une classe pour que tous les elements soit pris en compte. si j'utilise un id="blabla" dans une boucle, il va prendre que le premier element
                e.preventDefault();
                var url = $(this).data("url2");
                console.log("url information" + url);
                $("#showComments").load(url);
            });
        });
    </script>
</head>
<!-------------------------------------------------------------HEADER---------------------------------------------------------------------->
@*<div class="jumbotron-fluid col-12 col-md-12 col-lg-12 mx-auto backgroundSubchapter">
    <header class="my-auto">
        <!-----------------------------------------TEXT DU HEADER------------------------------------------------>
        <h1 class="animated bounceInDown text-white text-center bigtitlePosition" style="font-size:8vw;"><b class="text-info">@ViewBag.firstLetterSubChapName</b>@ViewBag.theme_name</h1>
        <span class="animated bounce centered"></span>
    </header>
    <divEffect>
    </divEffect>
</div>
<!-------------------------------------------------------------FIN HEADER---------------------------------------------------------------------->
<!----------------------------------TITRE ANIMATION----------------------------------------------->
<section class="container-fluid grad9 col-12 col-md-12 col-lg-12 col-sm-12 pb-0 pt-5">
    <divh2 class=" mx-auto text-center divh2Size" data-aos="fade-left" data-aos-offset="300" data-aos-easing="ease-in-sine">
        <h2 class=" animated col-md-12 col-lg-12 col-sm-12 rounded-pill bgScrollPage text-white text-capitalize">
            Description
        </h2>
    </divh2>

    <div class=" text-white pt-3 pb-3">
        <p class="text-dark text-center" data-aos="zoom-in">@Model.CurrentSubchapter.description</p>
    </div>
</section>
<!----------------------------------FIN TITRE ANIMATION----------------------------------------------->
<!----------------------------------TITRE ANIMATION----------------------------------------------->
<section class="container-fluid grad10 ">
    <divh2 class=" mx-auto text-center divh2Size" data-aos="fade-left" data-aos-offset="300" data-aos-easing="ease-in-sine">
        <h2 class=" animated col-md-12 col-lg-12 col-sm-12 rounded-pill bgScrollPage text-white text-capitalize">
            @ViewBag.subchapterTitle
        </h2>
    </divh2>
</section>*@
<!----------------------------------FIN TITRE ANIMATION----------------------------------------------->
<!------------------------------------------------------------PARTIE POWER POINT VIDEO--------------------------------------------------------------------->
<section class="container-fluid bg-dark pt-5">

    <!--PARTIE POUR AFFICHER LA LISTE DES CHAPITRES ET SOUS CHAPTITRE A GAUCHE DES VIDEOS-->
    <div>
        <div class="container col-lg-4 col-md-4" id="loadfromList">
            <!--Ajout d'un progress bar en cercle-->
            <div class="text-light bg-secondary text-center pt-3 pb-3" id="container">
                <p>Votre progression</p>
                @Html.Partial("_ProgressBarPartial")
            </div>

            <!--fi de progress bar-->
            @for (int i = 0; i < Model.ListChapter.Count; i++)
            {
                int n = @i + 1;
                <article class="info-block col-md-12  col-12 col-lg-12 bg-white shadow-lg border" data-aos="fade-up">
                    @*<h5 class="text-muted pb-3" data-toggle="collapse" data-target="#@Model.tag[i]"><b class="text-info">Section :</b> <b class="text-danger">@n</b></h5>*@
 
                    <b class="font-weight-light text-info" style="font-size:large" data-toggle="collapse" data-target="#@Model.tag[i]">@Model.ListChapter[i].name</b>
                    <p class="text-justify text-left">@Model.CountVideoViewByUser(@Model.ListChapter[i].id, Model.UID)/@Model.CountSubChapterOfChapter(Model.ListChapter[i].id) | @Model.TotalTimeChapter(Model.ListChapter[i].id)</p>
                    
                    <div class="pl-5 collapse spoiler-example" id="@Model.tag[i]">
                   
                        @for (int j = 0; j < @Model.ListSubchapter.Count; j++)
                        {
                            if (@Model.ListSubchapter[j].chapter_id == @Model.ListChapter[i].id)
                            {
                                ind2 = ind2 + 1;
                                <div class="container-fluid">
                                    <div class="col-md-12 col-sm-12 col-lg-12 col-12 text-muted bg-white font-italic">
                                        <!-- je vais charger que la video de la page via une fonction qui me retourne une vue partiel-->
                                        @foreach (var s in Model.ListSeen)
                                        {
                                            if (s.subchapter_id == @Model.ListSubchapter[j].id && s.seen == true)
                                            {
                                                <img class="float-right imgsize" src="~/Content/Img/seen.png" />
                                            }
                                        }
                                        <a class="col-6 col-sm-4 col-md-6 col-lg-6 loadVideo loadComment" data-url='@Url.Action("GetSubchapterVideo", new { sub_chapter_id = Model.ListSubchapter[j].id })' data-url2='@Url.Action("GetComments", new { sub_chapter_id = Model.ListSubchapter[j].id })'>
                                            @Model.ListSubchapter[j].name
                                        </a>
                                        <p style="color:Highlight">@Model.ListSubchapter[j].time_video minutes</p>
                                        @*@totalTimeVideo = @totalTimeVideo + @Model.ListSubchapter[j].time_video minutes*@

                                    </div>
                                </div>
                                <hr class=" hrClassColor w-100" />
                            }

                        }
                    </div>
                  
                </article>
                <div class="col-md-6" style="height:30px"></div>
            }
        </div>
        <!--FIN PARTIE DAFFICHAGE DE LA LISTE DES CHAPTIRE ET SOUS CHAPITRE-->

        <divpv class="container bg-dark col-md-8 col-12 col-lg-8 pb-5 sticky" id="showVideo">
            @Html.Partial("_PartialVideo")
        </divpv>
    </div>

</section>

<!------------------------------------------------------------FIN PARTIE VIDEO--------------------------------------------------------------------->
<div class="container-fluid col-lg-12">
    <div class="row align-items-center">
        <!------------------------------LA PARTIE COMMENTAIRE---------------------------------------------->
        @*@using (Html.BeginForm("SaveComment", "Comment_", FormMethod.Post))
            {*@
        <!----------------------------------TITRE ANIMATION----------------------------------------------->
        <section class="container-fluid grad11 pt-5 pb-5">
            <divh2 class="mx-auto text-center divh2Size" data-aos="fade-left" data-aos-offset="300" data-aos-easing="ease-in-sine">
                <h2 class=" animated col-md-12 col-lg-12 col-sm-12 rounded-pill bgScrollPage text-white text-capitalize">
                    Commentaires
                </h2>
            </divh2>
        </section>
        <!----------------------------------FIN TITRE ANIMATION----------------------------------------------->
        <form class="container col-md-10 col-lg-10 col-12 pb-5" id="addComment" method="post" enctype="multipart/form-data" onsubmit="return AjaxPost(this)">
            <textarea class="form-control bg-white shadow-lg" aria-label="With textarea" data-toggle="collapse" data-target="#com" placeholder="Ajouter un commentaire..." name="msg" id="msg" rows="5"></textarea>
            <div id="com" class="collapse align-items-center">
                <button type="submit" id="btncomment" class="btn btn-block btn-outline-secondary btn-info">Ajouter un commentaire</button>
                <button type="reset" id="btncomment" class="btn btn-block btn-outline-secondary btn-danger" data-toggle="collapse" data-target="#com" onclick="user_onclear()">Annuler</button>
                <input type="hidden" value="@ViewBag.userID" name="uid" id="uid" />
                <input type="hidden" value="@Model.CurrentSubchapter.id" name="subchapter_id" id="subchapter_id" />
                <hr class=" hrColor2 w-100" />
            </div>
        </form>

        @*}*@
        <!-- SOUS PARTIE CONCERNANT LE COMMENTAIRE UTILISATEUR AINSI QUE LES REPONSES-->
        <div class="container col-lg-10 col-lg-offset col-md-12 col-md-offset-1" id="showComments">
            @Html.Partial("_CommentPartial")
        </div>
    </div>
    <!------------------------------ FIN DE LA PARTIE COMMENTAIRE-------------------------------------->
</div>


<!--SCRIPT POUR LE SCROLL-->
<script>

    $(document).ready(function () {
        // Check if element is scrolled into view
        function isScrolledIntoView(elem) {
            var docViewTop = $(window).scrollTop();
            var docViewBottom = docViewTop + $(window).height();

            var elemTop = $(elem).offset().top;
            var elemBottom = elemTop + $(elem).height();

            return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
        }
        // If element is scrolled into view, fade it in
        $(window).scroll(function () {
            $('.scroll-animations .animated').each(function () {
                if (isScrolledIntoView(this) === true) {
                    $(this).addClass('fadeInLeft');
                }
            });
        });

    });
</script>


<!--script effet du fade sur les image(arrivage des images petit a petit)-->
<script src="~/Scripts/aos.js"></script>
<script>
    AOS.init({
        easing: 'ease-in-out-sine'
    });
</script>
